name: Run Telegram to YouTube Uploader

on:
  # Allows manual running of the workflow via the GitHub Actions UI
  workflow_dispatch:
    inputs:
      telegram_link:
        description: 'Full Telegram message link (e.g., https://t.me/c/ID/MSG_ID)'
        required: true
        type: string
      video_title:
        description: 'Optional Title for the YouTube Video'
        required: false
        type: string
      
jobs:
  upload:
    runs-on: ubuntu-latest
    
    # Set environment variables using the GitHub Secrets
    env:
      TG_API_ID: ${{ secrets.TG_API_ID }}
      TG_API_HASH: ${{ secrets.TG_API_HASH }}
      TG_SESSION_STRING: ${{ secrets.TG_SESSION_STRING }}

      YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
      YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
      YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # Use a stable Python version

      - name: Install dependencies
        run: pip install -r requirements.txt
        
      - name: Run Uploader Script
        run: python uploader_script.py "${{ github.event.inputs.telegram_link }}"
        # Pass the user's input (the Telegram link) directly to the Python script as an argument.
